import type { NextApiRequest, NextApiResponse } from "next";
import { VertexAI } from "@google-cloud/vertexai";
import { BigQuery } from "@google-cloud/bigquery";

// ===== Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ =====
type AskRequestBody = {
  query?: string;
  mode?: "detailed" | "brief" | "bullets";
  detailLevel?: "low" | "medium" | "high";
};

type SearchResult = {
  text: string;
  book_id: string;
  source_table: string;
  confidence: number;
};

type AskSuccessResponse = {
  answer: string;
  mode: string;
  detailLevel: string;
  model: string;
  sources: SearchResult[];
  tablesSearched: string[];
  totalTables: number;
};

type AskErrorResponse = {
  error: string;
};

type ApiResponse = AskSuccessResponse | AskErrorResponse;

// ===== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =====
const projectId = "iqraa-12";
const location = "us-central1";
const modelName = "gemini-2.0-flash";
const datasetId = "iqraa_12_dataset";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© - 134 Ø¬Ø¯ÙˆÙ„ Ù…ØµÙ†Ù‘Ù
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TABLE_KEYWORDS: Record<string, string[]> = {
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“š Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„Ø£ØµÙˆÙ„ ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "01_fiqh_rulings": [
    "ÙÙ‚Ù‡", "Ø­ÙƒÙ…", "ÙØªÙˆÙ‰", "Ø­Ù„Ø§Ù„", "Ø­Ø±Ø§Ù…", "ÙˆØ§Ø¬Ø¨", "Ù…Ø³ØªØ­Ø¨", "Ù…ÙƒØ±ÙˆÙ‡",
    "Ø²ÙƒØ§Ø©", "ØµÙ„Ø§Ø©", "ØµÙˆÙ…", "Ø­Ø¬", "Ø·Ù‡Ø§Ø±Ø©", "ÙˆØ¶ÙˆØ¡", "Ù†ÙƒØ§Ø­", "Ø·Ù„Ø§Ù‚",
    "Ø¨ÙŠØ¹", "Ø´Ø±Ø§Ø¡", "Ø±Ø¨Ø§", "Ù…ÙŠØ±Ø§Ø«", "ÙˆØµÙŠØ©", "Ù†ÙÙ‚Ø©", "Ø¹Ø¨Ø§Ø¯Ø§Øª", "Ù…Ø¹Ø§Ù…Ù„Ø§Øª"
  ],
  
  "fiqh_rulings_and_nawazil": [
    "Ù†Ø§Ø²Ù„Ø©", "Ù†ÙˆØ§Ø²Ù„", "ÙØªÙˆÙ‰", "Ù…Ø³Ø£Ù„Ø©", "Ø­Ø§Ø¯Ø«Ø©", "ÙˆØ§Ù‚Ø¹Ø©", "Ø§Ø³ØªÙØªØ§Ø¡",
    "Ù‚Ø¶ÙŠØ©", "Ø­ÙƒÙ… Ø´Ø±Ø¹ÙŠ", "Ø§Ø¬ØªÙ‡Ø§Ø¯", "ØªØ®Ø±ÙŠØ¬", "ÙÙ‚Ù‡ Ø§Ù„ÙˆØ§Ù‚Ø¹"
  ],
  
  "05_usul_and_maqasid": [
    "Ø£ØµÙˆÙ„", "Ù…Ù‚Ø§ØµØ¯", "Ù‚ÙŠØ§Ø³", "Ø¥Ø¬Ù…Ø§Ø¹", "Ø§Ø¬ØªÙ‡Ø§Ø¯", "ØªÙ‚Ù„ÙŠØ¯", "Ø§Ø³ØªÙ†Ø¨Ø§Ø·",
    "Ù…ØµÙ„Ø­Ø©", "Ø¶Ø±ÙˆØ±Ø©", "Ø­Ø§Ø¬Ø©", "ØªØ­Ø³ÙŠÙ†", "Ø¹Ù„Ø©", "Ø­ÙƒÙ…Ø©", "Ø¯Ù„ÙŠÙ„",
    "Ù†Øµ", "Ø¸Ø§Ù‡Ø±", "Ù…Ø¤ÙˆÙ„", "Ø¹Ø§Ù…", "Ø®Ø§Øµ", "Ù…Ø·Ù„Ù‚", "Ù…Ù‚ÙŠØ¯"
  ],
  
  "standards_of_proof_evolution": [
    "Ø¨Ø±Ù‡Ø§Ù†", "Ø¯Ù„ÙŠÙ„", "Ø­Ø¬Ø©", "Ø¥Ø«Ø¨Ø§Øª", "Ø¨ÙŠÙ†Ø©", "Ø´Ù‡Ø§Ø¯Ø©", "Ù‚Ø±ÙŠÙ†Ø©",
    "ÙŠÙ‚ÙŠÙ†", "Ø¸Ù†", "Ø´Ùƒ", "ÙˆÙ‡Ù…"
  ],
  
  "legal_and_administrative_decrees": [
    "Ù…Ø±Ø³ÙˆÙ…", "Ù‚Ø§Ù†ÙˆÙ†", "Ù†Ø¸Ø§Ù…", "Ù‚Ø±Ø§Ø±", "Ø£Ù…Ø±", "ÙØ±Ù…Ø§Ù†", "Ø¸Ù‡ÙŠØ±",
    "ØªØ´Ø±ÙŠØ¹", "Ù„Ø§Ø¦Ø­Ø©", "Ø¯Ø³ØªÙˆØ±"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“– Ø§Ù„Ø­Ø¯ÙŠØ« ÙˆØ§Ù„Ø±ÙˆØ§ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "hadith_corpus_analysis": [
    "Ø­Ø¯ÙŠØ«", "Ø³Ù†Ø©", "Ø±ÙˆØ§ÙŠØ©", "Ø¥Ø³Ù†Ø§Ø¯", "Ø³Ù†Ø¯", "Ù…ØªÙ†", "Ø±Ø§ÙˆÙŠ",
    "ØµØ­ÙŠØ­", "Ø­Ø³Ù†", "Ø¶Ø¹ÙŠÙ", "Ù…ÙˆØ¶ÙˆØ¹", "Ù…Ø±ÙÙˆØ¹", "Ù…ÙˆÙ‚ÙˆÙ", "Ù…Ù‚Ø·ÙˆØ¹",
    "Ø¨Ø®Ø§Ø±ÙŠ", "Ù…Ø³Ù„Ù…", "ØªØ±Ù…Ø°ÙŠ", "Ù†Ø³Ø§Ø¦ÙŠ", "Ø£Ø¨Ùˆ Ø¯Ø§ÙˆØ¯", "Ø§Ø¨Ù† Ù…Ø§Ø¬Ù‡"
  ],
  
  "weak_hadiths_ai_retrial_v2": [
    "Ø¶Ø¹ÙŠÙ", "Ù…Ø¹Ù„ÙˆÙ„", "Ù…Ù†ÙƒØ±", "Ø´Ø§Ø°", "Ù…Ø¶Ø·Ø±Ø¨", "Ù…Ø¯Ù„Ø³", "Ù…Ø±Ø³Ù„",
    "Ø¹Ù„Ø©", "Ø¬Ø±Ø­", "ØªØ¹Ø¯ÙŠÙ„", "Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‚ÙŠÙŠÙ…"
  ],
  
  "fabricated_hadiths_network": [
    "Ù…ÙˆØ¶ÙˆØ¹", "Ù…ÙƒØ°ÙˆØ¨", "ÙˆØ¶Ù‘Ø§Ø¹", "ÙƒØ°Ù‘Ø§Ø¨", "Ø§Ø®ØªÙ„Ø§Ù‚", "Ø§ÙØªØ±Ø§Ø¡",
    "Ù„Ø§ Ø£ØµÙ„ Ù„Ù‡", "Ø¨Ø§Ø·Ù„", "Ù…Ù†ÙƒØ± Ø¬Ø¯Ø§Ù‹"
  ],
  
  "ijaza_chains_and_transmission": [
    "Ø¥Ø¬Ø§Ø²Ø©", "Ø³Ù…Ø§Ø¹", "Ù‚Ø±Ø§Ø¡Ø©", "Ù…Ù†Ø§ÙˆÙ„Ø©", "ÙƒØªØ§Ø¨Ø©", "ÙˆØ¬Ø§Ø¯Ø©",
    "Ø´ÙŠØ®", "ØªÙ„Ù…ÙŠØ°", "Ø·Ø§Ù„Ø¨", "Ø±Ø­Ù„Ø© Ø¹Ù„Ù…ÙŠØ©", "Ø·Ù„Ø¨ Ø§Ù„Ø¹Ù„Ù…"
  ],
  
  "israiliyat_and_biblical_narratives": [
    "Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠØ§Øª", "Ø£Ù‡Ù„ Ø§Ù„ÙƒØªØ§Ø¨", "ØªÙˆØ±Ø§Ø©", "Ø¥Ù†Ø¬ÙŠÙ„", "ÙŠÙ‡ÙˆØ¯", "Ù†ØµØ§Ø±Ù‰",
    "ÙƒØ¹Ø¨ Ø§Ù„Ø£Ø­Ø¨Ø§Ø±", "ÙˆÙ‡Ø¨ Ø¨Ù† Ù…Ù†Ø¨Ù‡", "Ù‚ØµØµ Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡"
  ],
  
  "israiliyat_narrative_forensics": [
    "ØªØ­Ù‚ÙŠÙ‚", "ØªÙ…Ø­ÙŠØµ", "Ù†Ù‚Ø¯", "ØªØªØ¨Ø¹", "Ù…ØµØ¯Ø±", "Ø£ØµÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ•Œ Ø§Ù„Ø¹Ù‚ÙŠØ¯Ø© ÙˆØ¹Ù„Ù… Ø§Ù„ÙƒÙ„Ø§Ù…
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "04_kalam_schools": [
    "Ø¹Ù‚ÙŠØ¯Ø©", "ÙƒÙ„Ø§Ù…", "Ø£Ø´Ø§Ø¹Ø±Ø©", "Ù…Ø¹ØªØ²Ù„Ø©", "Ù…Ø§ØªØ±ÙŠØ¯ÙŠØ©", "Ø³Ù„ÙÙŠØ©",
    "ØªÙˆØ­ÙŠØ¯", "ØµÙØ§Øª", "Ù‚Ø¯Ø±", "Ø¥ÙŠÙ…Ø§Ù†", "ÙƒÙØ±", "Ø´Ø±Ùƒ",
    "Ø§Ù„Ù„Ù‡", "Ø§Ù„Ø±Ø¨", "Ø§Ù„Ø®Ø§Ù„Ù‚", "Ø§Ù„Ù‚Ø¶Ø§Ø¡", "Ø§Ù„Ù‚Ø¯Ø±"
  ],
  
  "kalam_and_theological_schools": [
    "Ù…Ø°Ù‡Ø¨ ÙƒÙ„Ø§Ù…ÙŠ", "ÙØ±Ù‚Ø©", "Ø·Ø§Ø¦ÙØ©", "Ù…Ù‚Ø§Ù„Ø§Øª", "Ø§Ø¹ØªÙ‚Ø§Ø¯",
    "Ø£Ù‡Ù„ Ø§Ù„Ø³Ù†Ø©", "Ø´ÙŠØ¹Ø©", "Ø®ÙˆØ§Ø±Ø¬", "Ù…Ø±Ø¬Ø¦Ø©", "Ø¬Ø¨Ø±ÙŠØ©", "Ù‚Ø¯Ø±ÙŠØ©"
  ],
  
  "interfaith_polemics": [
    "Ø¬Ø¯Ù„", "Ù…Ù†Ø§Ø¸Ø±Ø©", "Ø­ÙˆØ§Ø±", "Ø±Ø¯", "Ù†Ù‚Ø¶", "Ø¥Ø¨Ø·Ø§Ù„",
    "Ø£Ù‡Ù„ Ø§Ù„ÙƒØªØ§Ø¨", "Ù…Ù„Ù„", "Ù†Ø­Ù„", "Ø£Ø¯ÙŠØ§Ù†"
  ],
  
  "interfaith_polemics_and_dialogue": [
    "Ø­ÙˆØ§Ø± Ø£Ø¯ÙŠØ§Ù†", "ØªÙ‚Ø§Ø±Ø¨", "Ø§Ø®ØªÙ„Ø§Ù", "Ù…Ø´ØªØ±Ùƒ", "ØªØ³Ø§Ù…Ø­"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸŒ™ Ø§Ù„ØªØµÙˆÙ ÙˆØ§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "09_sufism_spirituality": [
    "ØªØµÙˆÙ", "ØµÙˆÙÙŠ", "Ø·Ø±ÙŠÙ‚Ø©", "ÙˆÙ„ÙŠ", "ÙƒØ±Ø§Ù…Ø©", "Ø²Ù‡Ø¯",
    "ØªØ²ÙƒÙŠØ©", "Ù‚Ù„Ø¨", "Ù†ÙØ³", "Ø±ÙˆØ­", "Ù…Ù‚Ø§Ù…", "Ø­Ø§Ù„",
    "Ø°ÙƒØ±", "ÙˆØ±Ø¯", "Ø®Ù„ÙˆØ©", "Ù…Ø±ÙŠØ¯", "Ø´ÙŠØ®", "Ø³Ø§Ù„Ùƒ"
  ],
  
  "sufi_orders_and_practices": [
    "Ø·Ø±ÙŠÙ‚Ø©", "Ù‚Ø§Ø¯Ø±ÙŠØ©", "Ù†Ù‚Ø´Ø¨Ù†Ø¯ÙŠØ©", "Ø´Ø§Ø°Ù„ÙŠØ©", "ØªÙŠØ¬Ø§Ù†ÙŠØ©", "Ø±ÙØ§Ø¹ÙŠØ©",
    "Ø³Ù…Ø§Ø¹", "Ø­Ø¶Ø±Ø©", "Ù…ÙˆÙ„Ø¯", "Ø²Ø§ÙˆÙŠØ©", "ØªÙƒÙŠØ©", "Ø®Ø§Ù†Ù‚Ø§Ù‡"
  ],
  
  "dreams_visions_and_spiritual_experiences": [
    "Ø±Ø¤ÙŠØ§", "Ù…Ù†Ø§Ù…", "Ø­Ù„Ù…", "ÙƒØ´Ù", "Ø¥Ù„Ù‡Ø§Ù…", "ÙØ±Ø§Ø³Ø©",
    "Ø¨ØµÙŠØ±Ø©", "Ù…ÙƒØ§Ø´ÙØ©", "ØªØ¬Ù„ÙŠ"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ›ï¸ Ø§Ù„ÙÙ„Ø³ÙØ© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "10_philosophy_logic": [
    "ÙÙ„Ø³ÙØ©", "Ù…Ù†Ø·Ù‚", "Ø¨Ø±Ù‡Ø§Ù†", "Ù‚ÙŠØ§Ø³", "Ù…Ù‚Ø¯Ù…Ø©", "Ù†ØªÙŠØ¬Ø©",
    "Ø¬ÙˆÙ‡Ø±", "Ø¹Ø±Ø¶", "Ø¹Ù„Ø©", "Ù…Ø¹Ù„ÙˆÙ„", "ÙˆØ¬ÙˆØ¯", "Ù…Ø§Ù‡ÙŠØ©",
    "Ø¹Ù‚Ù„", "Ù†ÙØ³", "Ø·Ø¨ÙŠØ¹Ø©", "Ø¥Ù„Ù‡ÙŠØ§Øª", "Ù…Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©"
  ],
  
  "argumentation_methods_and_logic": [
    "Ø­Ø¬Ø§Ø¬", "Ø¬Ø¯Ù„", "Ù…ØºØ§Ù„Ø·Ø©", "Ù‚ÙŠØ§Ø³", "Ø§Ø³ØªÙ‚Ø±Ø§Ø¡", "ØªÙ…Ø«ÙŠÙ„",
    "Ø³ÙØ³Ø·Ø©", "Ù…Ù‚Ø¯Ù…Ø©", "Ù†ØªÙŠØ¬Ø©", "Ø¨Ø±Ù‡Ø§Ù†"
  ],
  
  "neoplatonic_infiltration_police": [
    "Ø£ÙÙ„ÙˆØ·ÙŠÙ†", "Ø£ÙÙ„Ø§Ø·ÙˆÙ†", "ÙÙŠØ¶", "Ø¥Ø´Ø±Ø§Ù‚", "ÙˆØ§Ø­Ø¯", "Ø¹Ù‚Ù„ ÙØ¹Ø§Ù„",
    "Ù‡Ø±Ù…Ø³", "ÙÙŠØ«Ø§ØºÙˆØ±Ø³", "Ù…Ø­Ø¯Ø«ÙˆÙ†"
  ],
  
  "scientific_and_philosophical_heritage": [
    "ØªØ±Ø§Ø« Ø¹Ù„Ù…ÙŠ", "ØªØ±Ø§Ø« ÙÙ„Ø³ÙÙŠ", "Ø­ÙƒÙ…Ø©", "Ù†Ø¸Ø±", "ØªØ£Ù…Ù„"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ‘‘ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙˆØ§Ù„Ø­ÙƒÙ…
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "11_rulers_segments": [
    "Ø®Ù„ÙŠÙØ©", "Ø³Ù„Ø·Ø§Ù†", "Ù…Ù„Ùƒ", "Ø£Ù…ÙŠØ±", "Ø­Ø§ÙƒÙ…", "ÙˆØ§Ù„ÙŠ",
    "Ø³ÙŠØ§Ø³Ø©", "Ø­ÙƒÙ…", "Ø¯ÙˆÙ„Ø©", "Ø®Ù„Ø§ÙØ©", "Ø¥Ù…Ø§Ø±Ø©", "Ø¨ÙŠØ¹Ø©"
  ],
  
  "ruler_profiles_and_policies": [
    "Ø³ÙŠØ±Ø© Ø­Ø§ÙƒÙ…", "Ø³ÙŠØ§Ø³Ø©", "Ù‚Ø±Ø§Ø±", "Ø¥ØµÙ„Ø§Ø­", "Ø¸Ù„Ù…", "Ø¹Ø¯Ù„"
  ],
  
  "political_eras_and_dynasties": [
    "Ø¯ÙˆÙ„Ø©", "Ø³Ù„Ø§Ù„Ø©", "Ø¹ØµØ±", "Ø£Ù…ÙˆÙŠ", "Ø¹Ø¨Ø§Ø³ÙŠ", "ÙØ§Ø·Ù…ÙŠ", "Ø£ÙŠÙˆØ¨ÙŠ", "Ù…Ù…Ù„ÙˆÙƒÙŠ", "Ø¹Ø«Ù…Ø§Ù†ÙŠ",
    "Ø±Ø§Ø´Ø¯ÙˆÙ†", "Ø£Ù…ÙˆÙŠÙˆÙ†", "Ø¹Ø¨Ø§Ø³ÙŠÙˆÙ†"
  ],
  
  "state_structure_and_policy": [
    "Ø¬Ù‡Ø§Ø² Ø¯ÙˆÙ„Ø©", "Ø¯ÙŠÙˆØ§Ù†", "ÙˆØ²Ø§Ø±Ø©", "Ø¥Ø¯Ø§Ø±Ø©", "Ø¨ÙŠØ±ÙˆÙ‚Ø±Ø§Ø·ÙŠØ©"
  ],
  
  "revolts_and_conflicts": [
    "Ø«ÙˆØ±Ø©", "ÙØªÙ†Ø©", "ØµØ±Ø§Ø¹", "Ø­Ø±Ø¨", "Ø§Ù†Ù‚Ù„Ø§Ø¨", "ØªÙ…Ø±Ø¯", "Ø¹ØµÙŠØ§Ù†"
  ],
  
  "global_hegemony_shifts": [
    "Ù‡ÙŠÙ…Ù†Ø©", "Ù‚ÙˆØ© Ø¹Ø¸Ù…Ù‰", "Ù†ÙÙˆØ°", "ØªÙˆØ§Ø²Ù† Ù‚ÙˆÙ‰", "ØµØ¹ÙˆØ¯", "Ø³Ù‚ÙˆØ·"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ’° Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ ÙˆØ§Ù„Ù…Ø§Ù„
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "08_economy_segments": [
    "Ø§Ù‚ØªØµØ§Ø¯", "Ù…Ø§Ù„", "ØªØ¬Ø§Ø±Ø©", "Ø³ÙˆÙ‚", "Ø±Ø¨Ø­", "Ø®Ø³Ø§Ø±Ø©",
    "Ø¯ÙŠÙ†Ø§Ø±", "Ø¯Ø±Ù‡Ù…", "Ø°Ù‡Ø¨", "ÙØ¶Ø©", "Ù†Ù‚Ø¯", "ØµØ±Ù"
  ],
  
  "economic_impact_on_knowledge": [
    "ØªÙ…ÙˆÙŠÙ„", "Ø±Ø¹Ø§ÙŠØ©", "Ø¥Ù†ÙØ§Ù‚", "Ù…ÙŠØ²Ø§Ù†ÙŠØ©", "Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ù…Ø¹Ø±ÙØ©"
  ],
  
  "economics_of_knowledge_production": [
    "Ø¥Ù†ØªØ§Ø¬ Ø¹Ù„Ù…ÙŠ", "ØªÙƒÙ„ÙØ©", "Ù†Ø³Ø®", "ÙˆØ±Ù‚", "Ø­Ø¨Ø±", "ÙƒØªØ§Ø¨"
  ],
  
  "waqf_and_philanthropy_network": [
    "ÙˆÙ‚Ù", "Ø£ÙˆÙ‚Ø§Ù", "Ø­Ø¨Ø³", "ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©", "Ø®ÙŠØ±Ø§Øª", "Ù…Ø¨Ø±Ø§Øª",
    "Ù†Ø§Ø¸Ø±", "Ù…ØªÙˆÙ„ÙŠ", "Ø´Ø±Ø· Ø§Ù„ÙˆØ§Ù‚Ù", "Ø±ÙŠØ¹", "ØºÙ„Ø©"
  ],
  
  "social_financial_profile": [
    "Ø«Ø±ÙˆØ©", "ÙÙ‚Ø±", "Ø·Ø¨Ù‚Ø©", "Ø¯Ø®Ù„", "Ù…Ø¹ÙŠØ´Ø©"
  ],
  
  "macro_economic_and_population_stats": [
    "Ø¥Ø­ØµØ§Ø¡", "Ø³ÙƒØ§Ù†", "ØªØ¹Ø¯Ø§Ø¯", "Ù†Ù…Ùˆ", "Ù‡Ø¬Ø±Ø©"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸŒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§ ÙˆØ§Ù„Ø£Ù…Ø§ÙƒÙ†
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "06_geography_knowledge": [
    "Ø¬ØºØ±Ø§ÙÙŠØ§", "Ù…ÙƒØ§Ù†", "Ø¨Ù„Ø¯", "Ù…Ø¯ÙŠÙ†Ø©", "Ù‚Ø±ÙŠØ©", "Ø¥Ù‚Ù„ÙŠÙ…",
    "Ø´Ø±Ù‚", "ØºØ±Ø¨", "Ø´Ù…Ø§Ù„", "Ø¬Ù†ÙˆØ¨"
  ],
  
  "geographical_locations_registry": [
    "Ù…ÙˆÙ‚Ø¹", "Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª", "Ø®Ø±ÙŠØ·Ø©", "Ø­Ø¯ÙˆØ¯", "Ù…Ø³Ø§ÙØ©"
  ],
  
  "geo_cultural_environment": [
    "Ø¨ÙŠØ¦Ø©", "Ù…Ù†Ø§Ø®", "ØªØ¶Ø§Ø±ÙŠØ³", "Ø«Ù‚Ø§ÙØ© Ù…Ø­Ù„ÙŠØ©"
  ],
  
  "locations_dictionary": [
    "Ù…Ø¹Ø¬Ù… Ø£Ù…Ø§ÙƒÙ†", "Ø¨Ù„Ø¯Ø§Ù†", "Ø£Ù‚Ø§Ù„ÙŠÙ…", "Ù†Ø³Ø¨Ø© Ù…ÙƒØ§Ù†ÙŠØ©"
  ],
  
  "places": [
    "Ù…ÙƒØ§Ù†", "Ù…ÙˆØ¶Ø¹", "Ø¨Ù‚Ø¹Ø©", "Ø¯Ø§Ø±", "Ø­Ø§Ø¶Ø±Ø©"
  ],
  
  "trade_routes_and_knowledge_transmission": [
    "Ø·Ø±ÙŠÙ‚ ØªØ¬Ø§Ø±Ø©", "Ù‚Ø§ÙÙ„Ø©", "Ø­Ø±ÙŠØ±", "Ø¨Ù‡Ø§Ø±Ø§Øª", "Ø§Ù†ØªÙ‚Ø§Ù„ Ø¹Ù„Ù…"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ‘¤ Ø§Ù„Ø£Ø´Ø®Ø§Øµ ÙˆØ§Ù„Ø¹Ù„Ù…Ø§Ø¡
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "author_profiles_master": [
    "Ù…Ø¤Ù„Ù", "Ø¹Ø§Ù„Ù…", "ÙÙ‚ÙŠÙ‡", "Ù…Ø­Ø¯Ø«", "Ù…ÙØ³Ø±", "Ø£Ø¯ÙŠØ¨",
    "Ø³ÙŠØ±Ø©", "ØªØ±Ø¬Ù…Ø©", "Ø·Ø¨Ù‚Ø§Øª"
  ],
  
  "persons": [
    "Ø´Ø®Øµ", "Ø¹Ø§Ù„Ù…", "ÙÙ‚ÙŠÙ‡", "Ø¥Ù…Ø§Ù…", "Ø´ÙŠØ®"
  ],
  
  "persons_copy": [
    "Ø´Ø®Øµ", "Ø¹Ø§Ù„Ù…"
  ],
  
  "person_relations": [
    "Ø¹Ù„Ø§Ù‚Ø©", "Ø´ÙŠØ®", "ØªÙ„Ù…ÙŠØ°", "ØµØ§Ø­Ø¨", "Ù…Ø¹Ø§ØµØ±", "Ø®ØµÙ…"
  ],
  
  "person_concepts": [
    "ÙÙƒØ±", "Ù…Ø°Ù‡Ø¨", "Ø±Ø£ÙŠ", "Ù…ÙˆÙ‚Ù", "Ø§ØªØ¬Ø§Ù‡"
  ],
  
  "women_scholars_and_intellectuals": [
    "Ø¹Ø§Ù„Ù…Ø©", "Ù…Ø­Ø¯Ø«Ø©", "ÙÙ‚ÙŠÙ‡Ø©", "Ø£Ø¯ÙŠØ¨Ø©", "Ø´Ø§Ø¹Ø±Ø©",
    "Ù†Ø³Ø§Ø¡", "Ø§Ù…Ø±Ø£Ø©", "Ø¨Ù†Øª", "Ø£Ù…"
  ],
  
  "ethnic_lineage": [
    "Ù†Ø³Ø¨", "Ù‚Ø¨ÙŠÙ„Ø©", "Ø¹Ø±Ù‚", "Ø£ØµÙ„", "Ø³Ù„Ø§Ù„Ø©", "Ø¹Ø±Ø¨ÙŠ", "ÙØ§Ø±Ø³ÙŠ", "ØªØ±ÙƒÙŠ", "Ø¨Ø±Ø¨Ø±ÙŠ"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“š Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø®Ø·ÙˆØ·Ø§Øª
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "book_metadata_registry": [
    "ÙƒØªØ§Ø¨", "Ù…Ø¤Ù„Ù", "ØªØ£Ù„ÙŠÙ", "ØªØµÙ†ÙŠÙ", "Ù…Ø¬Ù„Ø¯", "Ø¬Ø²Ø¡"
  ],
  
  "manuscripts_catalogue": [
    "Ù…Ø®Ø·ÙˆØ·", "Ù†Ø³Ø®Ø©", "Ø®Ø·ÙŠØ©", "Ù†Ø§Ø³Ø®", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø³Ø®"
  ],
  
  "libraries_and_book_collections": [
    "Ù…ÙƒØªØ¨Ø©", "Ø®Ø²Ø§Ù†Ø©", "Ø¯Ø§Ø± ÙƒØªØ¨", "ÙÙ‡Ø±Ø³", "Ù…Ø¬Ù…ÙˆØ¹Ø©"
  ],
  
  "corpus_registry": [
    "Ù…Ø¯ÙˆÙ†Ø©", "Ù…ØªÙ†", "Ù†Øµ", "Ø£Ø±Ø´ÙŠÙ"
  ],
  
  "corpus_quality_assessment": [
    "Ø¬ÙˆØ¯Ø©", "ØªØ­Ù‚ÙŠÙ‚", "Ø¶Ø¨Ø·", "Ù…Ù‚Ø§Ø¨Ù„Ø©"
  ],
  
  "raw_library": [
    "Ù…ÙƒØªØ¨Ø© Ø®Ø§Ù…", "Ù†ØµÙˆØµ Ø£ÙˆÙ„ÙŠØ©"
  ],
  
  "texts": [
    "Ù†Øµ", "Ù…ØªÙ†", "Ø¹Ø¨Ø§Ø±Ø©", "ÙÙ‚Ø±Ø©"
  ],
  
  "text_segments_micro_index": [
    "Ù…Ù‚Ø·Ø¹", "Ø´Ø±ÙŠØ­Ø©", "Ø¬Ø²Ø¡", "ÙÙ‡Ø±Ø³"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“ Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¤Ø³Ø³Ø§Øª
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "institutions_registry": [
    "Ù…Ø¤Ø³Ø³Ø©", "Ù…Ø¹Ù‡Ø¯", "Ù…Ø¯Ø±Ø³Ø©", "Ø¬Ø§Ù…Ø¹Ø©", "ÙƒÙ„ÙŠØ©"
  ],
  
  "educational_journey": [
    "Ø±Ø­Ù„Ø© Ø¹Ù„Ù…ÙŠØ©", "Ø·Ù„Ø¨ Ø¹Ù„Ù…", "Ø¯Ø±Ø§Ø³Ø©", "ØªØ¹Ù„Ù…", "ØªØ¯Ø±ÙŠØ³"
  ],
  
  "pedagogical_practices_and_learning": [
    "ØªØ±Ø¨ÙŠØ©", "ØªØ¹Ù„ÙŠÙ…", "Ù…Ù†Ù‡Ø¬", "Ø·Ø±ÙŠÙ‚Ø© ØªØ¯Ø±ÙŠØ³", "Ø­Ù„Ù‚Ø©", "Ø¯Ø±Ø³"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ›ï¸ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ÙÙƒØ±ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "schools": [
    "Ù…Ø¯Ø±Ø³Ø© ÙÙƒØ±ÙŠØ©", "Ø§ØªØ¬Ø§Ù‡", "ØªÙŠØ§Ø±", "Ù…Ù†Ù‡Ø¬"
  ],
  
  "intellectual_schools": [
    "Ù…Ø°Ù‡Ø¨", "Ù…Ø¯Ø±Ø³Ø©", "ÙÙƒØ±", "Ù…Ù†Ù‡Ø¬", "Ø§ØªØ¬Ø§Ù‡ ÙÙƒØ±ÙŠ"
  ],
  
  "intellectual_schools_bio_model": [
    "Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø©", "Ù†Ø´Ø£Ø©", "ØªØ·ÙˆØ±", "Ø§Ù†Ø­Ø¯Ø§Ø±", "Ø§Ù†Ø¯Ø«Ø§Ø±"
  ],
  
  "intellectual_networks_and_communities": [
    "Ø´Ø¨ÙƒØ© Ø¹Ù„Ù…ÙŠØ©", "Ø¬Ù…Ø§Ø¹Ø©", "Ø­Ù„Ù‚Ø©", "Ù…Ø¬Ù„Ø³", "Ù†Ø¯ÙˆØ©"
  ],
  
  "informal_networks": [
    "Ø´Ø¨ÙƒØ© ØºÙŠØ± Ø±Ø³Ù…ÙŠØ©", "ØµÙ„Ø§Øª", "Ø¹Ù„Ø§Ù‚Ø§Øª", "ØªÙˆØ§ØµÙ„"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“œ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… ÙˆØ§Ù„ØªØ·ÙˆØ± Ø§Ù„Ø¯Ù„Ø§Ù„ÙŠ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "concepts": [
    "Ù…ÙÙ‡ÙˆÙ…", "ÙÙƒØ±Ø©", "Ù…Ø¹Ù†Ù‰", "ØªØµÙˆØ±"
  ],
  
  "concepts_copy": [
    "Ù…ÙÙ‡ÙˆÙ…", "ÙÙƒØ±Ø©"
  ],
  
  "concept_history": [
    "ØªØ§Ø±ÙŠØ® Ù…ÙÙ‡ÙˆÙ…", "ØªØ·ÙˆØ± Ø¯Ù„Ø§Ù„ÙŠ", "ØªØ­ÙˆÙ„ Ù…Ø¹Ù†Ù‰"
  ],
  
  "text_concepts": [
    "Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ù†Øµ", "Ø£ÙÙƒØ§Ø±", "Ù…ÙˆØ¶ÙˆØ¹Ø§Øª"
  ],
  
  "text_concept": [
    "Ù…ÙÙ‡ÙˆÙ…", "ÙÙƒØ±Ø© Ø±Ø¦ÙŠØ³ÙŠØ©"
  ],
  
  "semantic_shifts_and_terminology": [
    "ØªØ­ÙˆÙ„ Ø¯Ù„Ø§Ù„ÙŠ", "Ù…ØµØ·Ù„Ø­", "Ø§ØµØ·Ù„Ø§Ø­", "ØªØ¹Ø±ÙŠÙ", "Ø­Ø¯"
  ],
  
  "linguistic_stylistic_evolution": [
    "ØªØ·ÙˆØ± Ù„ØºÙˆÙŠ", "Ø£Ø³Ù„ÙˆØ¨", "Ø¨Ù„Ø§ØºØ©", "ÙØµØ§Ø­Ø©"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸŒ Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­Ø¶Ø§Ø±ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "civilizational_shock_response": [
    "ØµØ¯Ù…Ø© Ø­Ø¶Ø§Ø±ÙŠØ©", "Ø§Ø³ØªØ¬Ø§Ø¨Ø©", "ØªÙƒÙŠÙ", "Ù…Ù‚Ø§ÙˆÙ…Ø©", "Ø§Ø³ØªØ¹Ù…Ø§Ø±"
  ],
  
  "civilizational_infiltration_ultimate": [
    "ØªØ³Ù„Ù„ Ø­Ø¶Ø§Ø±ÙŠ", "ØªØ£Ø«ÙŠØ±", "Ø§Ø®ØªØ±Ø§Ù‚", "ØªØºØ±ÙŠØ¨"
  ],
  
  "cultural_infiltration_into_fiqh": [
    "ØªØ£Ø«ÙŠØ± Ø«Ù‚Ø§ÙÙŠ", "ÙÙ‚Ù‡", "Ø¹Ø§Ø¯Ø§Øª", "Ø£Ø¹Ø±Ø§Ù"
  ],
  
  "concubine_slave_cultural_infiltration": [
    "Ø¬ÙˆØ§Ø±ÙŠ", "Ø¥Ù…Ø§Ø¡", "Ø±Ù‚ÙŠÙ‚", "ØªØ£Ø«ÙŠØ± Ø«Ù‚Ø§ÙÙŠ"
  ],
  
  "turkic_altaic_infiltration": [
    "ØªØ±ÙƒÙŠ", "Ù…ØºÙˆÙ„ÙŠ", "ØªØªØ§Ø±", "Ø³Ù„Ø§Ø¬Ù‚Ø©", "Ø¹Ø«Ù…Ø§Ù†ÙŠ"
  ],
  
  "foreign_reception_and_influence": [
    "Ø§Ø³ØªÙ‚Ø¨Ø§Ù„", "ØªØ£Ø«ÙŠØ± Ø£Ø¬Ù†Ø¨ÙŠ", "Ù†Ù‚Ù„", "ØªØ±Ø¬Ù…Ø©", "ØªØ¨Ù†ÙŠ"
  ],
  
  "translation_movements_and_choices": [
    "ØªØ±Ø¬Ù…Ø©", "Ù†Ù‚Ù„", "ØªØ¹Ø±ÙŠØ¨", "Ø¨ÙŠØª Ø§Ù„Ø­ÙƒÙ…Ø©", "Ø­Ù†ÙŠÙ† Ø¨Ù† Ø¥Ø³Ø­Ø§Ù‚"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ”¬ Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "epistemology_of_natural_sciences": [
    "Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©", "ÙÙŠØ²ÙŠØ§Ø¡", "ÙƒÙŠÙ…ÙŠØ§Ø¡", "ÙÙ„Ùƒ", "Ø·Ø¨", "Ø±ÙŠØ§Ø¶ÙŠØ§Øª"
  ],
  
  "scientific_practices_and_methods": [
    "Ù…Ù†Ù‡Ø¬ Ø¹Ù„Ù…ÙŠ", "ØªØ¬Ø±Ø¨Ø©", "Ù…Ù„Ø§Ø­Ø¸Ø©", "Ø§Ø³ØªÙ‚Ø±Ø§Ø¡"
  ],
  
  "methodological_hub": [
    "Ù…Ù†Ù‡Ø¬ÙŠØ©", "Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø­Ø«", "Ø£Ø¯ÙˆØ§Øª"
  ],
  
  "expert_methodologies_registry": [
    "Ù…Ù†Ù‡Ø¬ Ø®Ø¨ÙŠØ±", "ØªØ®ØµØµ", "Ø¥ØªÙ‚Ø§Ù†"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“Š Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø£Ø­Ø¯Ø§Ø«
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "comprehensive_timeline_events": [
    "Ø­Ø¯Ø«", "ÙˆØ§Ù‚Ø¹Ø©", "ØªØ§Ø±ÙŠØ®", "Ø³Ù†Ø©", "Ù‚Ø±Ù†", "Ø¹ØµØ±"
  ],
  
  "events": [
    "Ø­Ø¯Ø«", "ÙˆØ§Ù‚Ø¹Ø©", "Ù…Ù†Ø§Ø³Ø¨Ø©"
  ],
  
  "event_participants": [
    "Ù…Ø´Ø§Ø±Ùƒ", "Ø­Ø§Ø¶Ø±", "Ø´Ø§Ù‡Ø¯"
  ],
  
  "plagues_and_disasters": [
    "ÙˆØ¨Ø§Ø¡", "Ø·Ø§Ø¹ÙˆÙ†", "Ù…Ø¬Ø§Ø¹Ø©", "ÙƒØ§Ø±Ø«Ø©", "Ø²Ù„Ø²Ø§Ù„", "ÙÙŠØ¶Ø§Ù†"
  ],
  
  "climatic_shifts_and_hydrology": [
    "Ù…Ù†Ø§Ø®", "Ø·Ù‚Ø³", "Ø¬ÙØ§Ù", "Ù…Ø·Ø±", "Ù†Ù‡Ø±", "Ù…Ø§Ø¡"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ¨ Ø§Ù„ÙÙ†ÙˆÙ† ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "arts_architecture_and_aesthetics": [
    "ÙÙ†", "Ø¹Ù…Ø§Ø±Ø©", "Ø²Ø®Ø±ÙØ©", "Ø®Ø·", "Ù†Ù‚Ø´", "Ø¬Ù…Ø§Ù„",
    "Ù…Ø³Ø¬Ø¯", "Ù‚ØµØ±", "Ù‚Ø¨Ø©", "Ù…Ø¦Ø°Ù†Ø©", "Ù…Ø­Ø±Ø§Ø¨"
  ],
  
  "textual_genres_and_rhetorical_strategies": [
    "Ø¬Ù†Ø³ Ø£Ø¯Ø¨ÙŠ", "Ù†Ø«Ø±", "Ø´Ø¹Ø±", "Ø±Ø³Ø§Ù„Ø©", "Ù…Ù‚Ø§Ù…Ø©", "Ø¨Ù„Ø§ØºØ©"
  ],
  
  "marginalia_and_commentary_tradition": [
    "Ø­Ø§Ø´ÙŠØ©", "Ø´Ø±Ø­", "ØªØ¹Ù„ÙŠÙ‚", "ØªÙ‚Ø±ÙŠØ±", "Ù‡Ø§Ù…Ø´"
  ],
  
  "qussas_and_oral_culture": [
    "Ù‚ØµØ§Øµ", "ÙˆØ§Ø¹Ø¸", "Ù‚ØµØ©", "Ø­ÙƒØ§ÙŠØ©", "Ø³Ù…Ø±", "Ø´ÙØ§Ù‡ÙŠ"
  ],
  
  "non_textual_archive_and_artifacts": [
    "Ø¢Ø«Ø§Ø±", "Ù‚Ø·Ø¹", "Ù†Ù‚ÙˆØ¯", "Ø£Ø®ØªØ§Ù…", "Ù†Ù‚ÙˆØ´"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ‘¥ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ ÙˆØ§Ù„Ø­ÙŠØ§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "social_history_and_daily_life": [
    "Ø­ÙŠØ§Ø© ÙŠÙˆÙ…ÙŠØ©", "Ø¹Ø§Ø¯Ø§Øª", "ØªÙ‚Ø§Ù„ÙŠØ¯", "Ø·Ø¹Ø§Ù…", "Ù„Ø¨Ø§Ø³", "Ø³ÙƒÙ†",
    "Ø£Ø³Ø±Ø©", "Ø²ÙˆØ§Ø¬", "Ø£Ø¹ÙŠØ§Ø¯", "Ø§Ø­ØªÙØ§Ù„Ø§Øª"
  ],
  
  "demographics_and_migration": [
    "Ø³ÙƒØ§Ù†", "Ù‡Ø¬Ø±Ø©", "Ù†Ø²ÙˆØ­", "Ø§Ø³ØªÙŠØ·Ø§Ù†", "ØªÙˆØ²ÙŠØ¹ Ø³ÙƒØ§Ù†ÙŠ"
  ],
  
  "body_health_and_medical_history": [
    "ØµØ­Ø©", "Ù…Ø±Ø¶", "Ø·Ø¨", "Ø¹Ù„Ø§Ø¬", "Ø·Ø¨ÙŠØ¨", "Ø¯ÙˆØ§Ø¡"
  ],
  
  "tools_technologies_and_material_culture": [
    "Ø£Ø¯ÙˆØ§Øª", "ØªÙ‚Ù†ÙŠØ©", "ØµÙ†Ø§Ø¹Ø©", "Ø­Ø±ÙØ©", "Ø¢Ù„Ø©"
  ],
  
  "time_perception_and_calendars": [
    "ØªÙ‚ÙˆÙŠÙ…", "Ù‡Ø¬Ø±ÙŠ", "Ù…ÙŠÙ„Ø§Ø¯ÙŠ", "Ø´Ù‡Ø±", "ÙŠÙˆÙ…", "Ø³Ø§Ø¹Ø©"
  ],
  
  "competitions_and_contests": [
    "Ù…Ø³Ø§Ø¨Ù‚Ø©", "Ù…Ù†Ø§Ø¸Ø±Ø©", "ØªÙ†Ø§ÙØ³", "Ø¬Ø§Ø¦Ø²Ø©"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ” Ø§Ù„Ù†Ù‚Ø¯ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "historiographical_bias_and_orientalism": [
    "Ø§Ø³ØªØ´Ø±Ø§Ù‚", "ØªØ­ÙŠØ²", "Ù†Ù‚Ø¯", "Ù…Ø³ØªØ´Ø±Ù‚", "Ø±Ø¤ÙŠØ© ØºØ±Ø¨ÙŠØ©"
  ],
  
  "errors_corrections_and_revisions": [
    "Ø®Ø·Ø£", "ØªØµØ­ÙŠØ­", "Ù…Ø±Ø§Ø¬Ø¹Ø©", "ØªÙ†Ù‚ÙŠØ­", "Ø§Ø³ØªØ¯Ø±Ø§Ùƒ"
  ],
  
  "censorship_mechanisms_and_taboos": [
    "Ø±Ù‚Ø§Ø¨Ø©", "Ù…Ù†Ø¹", "Ø­Ø¸Ø±", "Ù…Ø­Ø±Ù…", "Ù…Ù…Ù†ÙˆØ¹", "ØªØ§Ø¨Ùˆ"
  ],
  
  "popular_pressure_and_scholarly_silence": [
    "Ø¶ØºØ· Ø´Ø¹Ø¨ÙŠ", "ØµÙ…Øª", "Ø³ÙƒÙˆØª", "ØªÙ‚ÙŠØ©", "Ù…Ø¯Ø§Ø±Ø§Ø©"
  ],
  
  "epistemic_crises_and_ruptures": [
    "Ø£Ø²Ù…Ø© Ù…Ø¹Ø±ÙÙŠØ©", "Ù‚Ø·ÙŠØ¹Ø©", "ØªØ­ÙˆÙ„", "Ø§Ù†Ù‚Ù„Ø§Ø¨ ÙÙƒØ±ÙŠ"
  ],
  
  "epistemic_silences_and_absences": [
    "ØµÙ…Øª Ù…Ø¹Ø±ÙÙŠ", "ØºÙŠØ§Ø¨", "ÙØ¬ÙˆØ©", "Ù†Ù‚Øµ"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ”— Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø´Ø¨ÙƒØ§Øª
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "knowledge_transmission_lines": [
    "Ù†Ù‚Ù„ Ø¹Ù„Ù…", "Ø³Ù„Ø³Ù„Ø©", "Ø¥Ø³Ù†Ø§Ø¯ Ø¹Ù„Ù…ÙŠ", "ØªÙ„Ù‚ÙŠ"
  ],
  
  "relationship_graph_nodes": [
    "Ø¹Ù‚Ø¯Ø©", "Ø±Ø§Ø¨Ø·", "Ø¹Ù„Ø§Ù‚Ø©", "Ø´Ø¨ÙƒØ©"
  ],
  
  "causal_graph_structure": [
    "Ø³Ø¨Ø¨ÙŠØ©", "Ø¹Ù„Ø§Ù‚Ø© Ø³Ø¨Ø¨ÙŠØ©", "ØªØ£Ø«ÙŠØ±", "Ù†ØªÙŠØ¬Ø©"
  ],
  
  "entity_graph_index_enhanced": [
    "ÙƒÙŠØ§Ù†", "ÙÙ‡Ø±Ø³", "Ø±Ø¨Ø·", "Ø¹Ù„Ø§Ù‚Ø©"
  ],
  
  "interdisciplinary_impact": [
    "ØªØ£Ø«ÙŠØ± Ù…ØªØ¨Ø§Ø¯Ù„", "ØªØ¯Ø§Ø®Ù„ Ø¹Ù„ÙˆÙ…", "ØªÙƒØ§Ù…Ù„"
  ],
  
  "internal_epistemic_evolution": [
    "ØªØ·ÙˆØ± Ø¯Ø§Ø®Ù„ÙŠ", "Ù†Ø¶Ø¬ ÙÙƒØ±ÙŠ", "ØªØ­ÙˆÙ„"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ğŸ“Š Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "academic_resources": [
    "Ø¨Ø­Ø«", "Ø¯Ø±Ø§Ø³Ø©", "Ø±Ø³Ø§Ù„Ø©", "Ø£Ø·Ø±ÙˆØ­Ø©", "Ù…Ù‚Ø§Ù„ Ø¹Ù„Ù…ÙŠ", "Ù…Ø¬Ù„Ø©"
  ],
  
  "readership_and_audience_analysis": [
    "Ù‚Ø±Ø§Ø¡", "Ø¬Ù…Ù‡ÙˆØ±", "Ù…ØªÙ„Ù‚ÙŠ", "Ø§Ù†ØªØ´Ø§Ø±"
  ],
  
  "online_media_links": [
    "Ø±Ø§Ø¨Ø·", "Ù…ÙˆÙ‚Ø¹", "Ø¥Ù†ØªØ±Ù†Øª", "Ø±Ù‚Ù…ÙŠ"
  ],
  
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // âš™ï¸ Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… (Ù„Ø§ ØªÙØ¨Ø­Ø« Ø¹Ø§Ø¯Ø©Ù‹)
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  
  "audit_log": ["Ø³Ø¬Ù„", "ØªØ¯Ù‚ÙŠÙ‚"],
  "system_audit_logs": ["Ø³Ø¬Ù„ Ù†Ø¸Ø§Ù…"],
  "agent_behavioral_rules": ["Ù‚ÙˆØ§Ø¹Ø¯", "ÙˆÙƒÙŠÙ„"],
  "fine_tuning_registry": ["Ø¶Ø¨Ø·", "ØªØ­Ø³ÙŠÙ†"],
  "model_validation_registry": ["ØªØ­Ù‚Ù‚", "Ù†Ù…ÙˆØ°Ø¬"],
  "ingestion_tracking_ledger": ["Ø§Ø³ØªÙŠØ¹Ø§Ø¨", "ØªØªØ¨Ø¹"],
  "interaction_quality_log": ["Ø¬ÙˆØ¯Ø© ØªÙØ§Ø¹Ù„"],
  "search_keywords_registry": ["ÙƒÙ„Ù…Ø§Øª Ø¨Ø­Ø«"],
  "smart_tools_registry": ["Ø£Ø¯ÙˆØ§Øª Ø°ÙƒÙŠØ©"],
  "smart_exploration_buffer": ["Ø§Ø³ØªÙƒØ´Ø§Ù"],
  "knowledge_discovery_buffer": ["Ø§ÙƒØªØ´Ø§Ù Ù…Ø¹Ø±ÙØ©"],
  "precomputed_query_paths_cache": ["Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù…Ø­Ø³ÙˆØ¨"],
  "implicit_assumptions_registry": ["Ø§ÙØªØ±Ø§Ø¶Ø§Øª"],
  "meta_critique_level": ["Ù†Ù‚Ø¯ ÙÙˆÙ‚ÙŠ"],
  "historical_questions_tracker": ["Ø£Ø³Ø¦Ù„Ø© ØªØ§Ø±ÙŠØ®ÙŠØ©"],
  "forecasting_models": ["ØªÙ†Ø¨Ø¤", "ØªÙˆÙ‚Ø¹"],
  "stochastic_event_generator": ["Ø¹Ø´ÙˆØ§Ø¦ÙŠ"],
  "system_dynamics_equations": ["Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Øª"],
  "counterfactual_parameter_space": ["Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¨Ø¯ÙŠÙ„"],
  "alternative_trajectories_counterfactuals": ["Ù…Ø³Ø§Ø± Ø¨Ø¯ÙŠÙ„"],
  "necessity_driven_innovation": ["Ø§Ø¨ØªÙƒØ§Ø±", "Ø¶Ø±ÙˆØ±Ø©"],
  "modern_ideology_streams": ["Ø£ÙŠØ¯ÙŠÙˆÙ„ÙˆØ¬ÙŠØ§", "Ø­Ø¯Ø§Ø«Ø©", "Ù…Ø¹Ø§ØµØ±"]
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TABLE_ARABIC_NAMES: Record<string, string> = {
  "01_fiqh_rulings": "Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…",
  "04_kalam_schools": "Ø¹Ù„Ù… Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆØ§Ù„Ø¹Ù‚ÙŠØ¯Ø©",
  "05_usul_and_maqasid": "Ø£ØµÙˆÙ„ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„Ù…Ù‚Ø§ØµØ¯",
  "06_geography_knowledge": "Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§ ÙˆØ§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…ÙƒØ§Ù†ÙŠØ©",
  "08_economy_segments": "Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ ÙˆØ§Ù„Ù…Ø§Ù„",
  "09_sufism_spirituality": "Ø§Ù„ØªØµÙˆÙ ÙˆØ§Ù„Ø±ÙˆØ­Ø§Ù†ÙŠØ©",
  "10_philosophy_logic": "Ø§Ù„ÙÙ„Ø³ÙØ© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚",
  "11_rulers_segments": "Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙˆØ§Ù„Ø­ÙƒÙ…",
  "academic_resources": "Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©",
  "author_profiles_master": "ØªØ±Ø§Ø¬Ù… Ø§Ù„Ù…Ø¤Ù„ÙÙŠÙ†",
  "book_metadata_registry": "ÙÙ‡Ø±Ø³ Ø§Ù„ÙƒØªØ¨",
  "hadith_corpus_analysis": "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ«",
  "weak_hadiths_ai_retrial_v2": "Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ø¶Ø¹ÙŠÙØ©",
  "fabricated_hadiths_network": "Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø©",
  "ijaza_chains_and_transmission": "Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª",
  "fiqh_rulings_and_nawazil": "Ø§Ù„ÙÙ‚Ù‡ ÙˆØ§Ù„Ù†ÙˆØ§Ø²Ù„",
  "kalam_and_theological_schools": "Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ÙƒÙ„Ø§Ù…ÙŠØ©",
  "sufi_orders_and_practices": "Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„ØµÙˆÙÙŠØ©",
  "intellectual_schools": "Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„ÙÙƒØ±ÙŠØ©",
  "political_eras_and_dynasties": "Ø§Ù„Ø¹ØµÙˆØ± ÙˆØ§Ù„Ø¯ÙˆÙ„",
  "waqf_and_philanthropy_network": "Ø§Ù„Ø£ÙˆÙ‚Ø§Ù ÙˆØ§Ù„Ø®ÙŠØ±Ø§Øª",
  "women_scholars_and_intellectuals": "Ø§Ù„Ø¹Ø§Ù„Ù…Ø§Øª ÙˆØ§Ù„Ù…ÙÙƒØ±Ø§Øª",
  "manuscripts_catalogue": "ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ø®Ø·ÙˆØ·Ø§Øª",
  "libraries_and_book_collections": "Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ÙˆØ¯ÙˆØ± Ø§Ù„ÙƒØªØ¨",
  "institutions_registry": "Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª",
  "plagues_and_disasters": "Ø§Ù„Ø£ÙˆØ¨Ø¦Ø© ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«",
  "arts_architecture_and_aesthetics": "Ø§Ù„ÙÙ†ÙˆÙ† ÙˆØ§Ù„Ø¹Ù…Ø§Ø±Ø©",
  "social_history_and_daily_life": "Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ",
  "interfaith_polemics": "Ø§Ù„Ø¬Ø¯Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø¯ÙŠØ§Ù†",
  "neoplatonic_infiltration_police": "Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø£ÙÙ„Ø§Ø·ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø«",
  "israiliyat_and_biblical_narratives": "Ø§Ù„Ø¥Ø³Ø±Ø§Ø¦ÙŠÙ„ÙŠØ§Øª",
  "translation_movements_and_choices": "Ø­Ø±ÙƒØ§Øª Ø§Ù„ØªØ±Ø¬Ù…Ø©",
  "civilizational_shock_response": "Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„ØµØ¯Ù…Ø© Ø§Ù„Ø­Ø¶Ø§Ø±ÙŠØ©",
  "turkic_altaic_infiltration": "Ø§Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠ",
  "persons": "Ø§Ù„Ø£Ø´Ø®Ø§Øµ",
  "places": "Ø§Ù„Ø£Ù…Ø§ÙƒÙ†",
  "schools": "Ø§Ù„Ù…Ø¯Ø§Ø±Ø³",
  "concepts": "Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ…",
  "events": "Ø§Ù„Ø£Ø­Ø¯Ø§Ø«",
  "texts": "Ø§Ù„Ù†ØµÙˆØµ",
  "text_segments_micro_index": "ÙÙ‡Ø±Ø³ Ø´Ø±Ø§Ø¦Ø­ Ø§Ù„Ù†ØµÙˆØµ",
  "comprehensive_timeline_events": "Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„",
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const vertexAI = new VertexAI({ project: projectId, location });
const generativeModel = vertexAI.getGenerativeModel({
  model: modelName,
  generationConfig: {
    maxOutputTokens: 4096,
    temperature: 0.3,
  },
});
const bigquery = new BigQuery();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ÙˆÙƒÙŠÙ„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø­Ø³Ù‘Ù†: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function detectRelevantTables(query: string): string[] {
  const queryLower = query.toLowerCase();
  const relevantTables: Set<string> = new Set();
  const tableScores: Map<string, number> = new Map();
  
  // Ø­Ø³Ø§Ø¨ Ø¯Ø±Ø¬Ø© ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
  for (const [tableName, keywords] of Object.entries(TABLE_KEYWORDS)) {
    let score = 0;
    for (const keyword of keywords) {
      if (queryLower.includes(keyword)) {
        score++;
      }
    }
    if (score > 0) {
      tableScores.set(tableName, score);
    }
  }
  
  // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø©
  const sortedTables = [...tableScores.entries()]
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10) // Ø£Ø¹Ù„Ù‰ 10 Ø¬Ø¯Ø§ÙˆÙ„
    .map(([table]) => table);
  
  // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ù†Ø§Ø³Ø¨Ø©ØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  if (sortedTables.length === 0) {
    return [
      "text_segments_micro_index",
      "book_metadata_registry",
      "01_fiqh_rulings",
      "hadith_corpus_analysis",
      "04_kalam_schools"
    ];
  }
  
  // Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù†Ø¶ÙŠÙ text_segments_micro_index Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù…
  if (!sortedTables.includes("text_segments_micro_index")) {
    sortedTables.push("text_segments_micro_index");
  }
  
  return sortedTables;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ BigQuery Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£ÙØ¶Ù„ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function searchInTable(
  tableName: string,
  query: string,
  limit: number = 5
): Promise<SearchResult[]> {
  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø«
  const searchTerms = query
    .split(/\s+/)
    .filter(word => word.length > 2)
    .slice(0, 5);
  
  if (searchTerms.length === 0) {
    return [];
  }
  
  // Ø¨Ù†Ø§Ø¡ Ø´Ø±ÙˆØ· Ø§Ù„Ø¨Ø­Ø«
  const conditions = searchTerms
    .map(term => `LOWER(CAST(text AS STRING)) LIKE '%${term}%'`)
    .join(" OR ");
  
  // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø¨Ø­Ø« Ù…Ø¹ Ø­Ù‚Ù„ text Ø£Ùˆ content
  const sqlQuery = `
    SELECT 
      COALESCE(CAST(text AS STRING), CAST(content AS STRING), '') as text,
      COALESCE(book_id, id, '') as book_id,
      '${tableName}' as source_table,
      COALESCE(classification_confidence, confidence, 0.5) as confidence
    FROM \`${projectId}.${datasetId}.${tableName}\`
    WHERE ${conditions}
    ORDER BY confidence DESC
    LIMIT ${limit}
  `;
  
  try {
    const [rows] = await bigquery.query({ query: sqlQuery });
    return rows.map((row: any) => ({
      text: String(row.text || "").slice(0, 1000),
      book_id: String(row.book_id || ""),
      source_table: tableName,
      confidence: Number(row.confidence) || 0.5,
    }));
  } catch (err) {
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø«Ø§Ù†ÙŠØ© Ø¨Ø­Ù‚ÙˆÙ„ Ù…Ø®ØªÙ„ÙØ©
    try {
      const fallbackQuery = `
        SELECT * FROM \`${projectId}.${datasetId}.${tableName}\`
        LIMIT ${limit}
      `;
      const [rows] = await bigquery.query({ query: fallbackQuery });
      
      return rows.slice(0, limit).map((row: any) => {
        const textField = row.text || row.content || row.description || 
                         row.name || row.title || JSON.stringify(row).slice(0, 500);
        return {
          text: String(textField).slice(0, 1000),
          book_id: String(row.book_id || row.id || ""),
          source_table: tableName,
          confidence: 0.3,
        };
      });
    } catch {
      console.warn(`Skipping ${tableName}: no accessible data`);
      return [];
    }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function searchAllRelevantTables(
  tables: string[],
  query: string
): Promise<SearchResult[]> {
  const allResults: SearchResult[] = [];
  
  // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ Ù„ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
  const searchPromises = tables.map(table => 
    searchInTable(table, query, 3)
  );
  
  const results = await Promise.all(searchPromises);
  
  for (const tableResults of results) {
    allResults.push(...tableResults);
  }
  
  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø«Ù‚Ø© ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…ÙƒØ±Ø±Ø§Øª
  const uniqueResults = allResults
    .filter((result, index, self) => 
      index === self.findIndex(r => r.text === result.text)
    )
    .sort((a, b) => b.confidence - a.confidence)
    .slice(0, 15);
  
  return uniqueResults;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function buildPromptWithContext(
  query: string,
  results: SearchResult[],
  mode?: string,
  detailLevel?: string
): string {
  const modeLabel =
    mode === "brief"
      ? "Ù‚Ø¯Ù‘Ù… Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø®ØªØµØ±Ø© Ù…Ø±ÙƒÙ‘Ø²Ø©."
      : mode === "bullets"
      ? "Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù†Ù‚Ø§Ø· Ù…Ø±ØªÙ‘Ø¨Ø©."
      : "Ù‚Ø¯Ù‘Ù… Ø¥Ø¬Ø§Ø¨Ø© ØªØ­Ù„ÙŠÙ„ÙŠØ© Ù…ÙØµÙ‘Ù„Ø©.";

  const detail =
    detailLevel === "low"
      ? "Ø§ÙƒØªÙÙ Ø¨Ø®Ù„Ø§ØµØ© Ø£Ø³Ø§Ø³ÙŠØ©."
      : detailLevel === "high"
      ? "Ø§Ø¯Ø®Ù„ ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ§Ù„Ø£Ù…Ø«Ù„Ø© ÙˆØ§Ù„Ø´ÙˆØ§Ù‡Ø¯."
      : "Ø§Ù„ØªÙØµÙŠÙ„ ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ù…ØªÙˆØ³Ø·.";

  // Ø¨Ù†Ø§Ø¡ Ø³ÙŠØ§Ù‚ Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
  let context = "";
  if (results.length > 0) {
    context = "\n\nğŸ“š Ø§Ù„Ù†ØµÙˆØµ Ø°Ø§Øª Ø§Ù„ØµÙ„Ø© Ù…Ù† Ø§Ù„ØªØ±Ø§Ø«:\n";
    context += "â•".repeat(50) + "\n";
    
    results.forEach((r, i) => {
      const tableArabic = getTableArabicName(r.source_table);
      context += `\n[${i + 1}] Ù…Ù† ${tableArabic}:\n`;
      context += `"${r.text}"\n`;
      if (r.book_id) {
        context += `ğŸ“– Ø§Ù„Ù…ØµØ¯Ø±: ${r.book_id}\n`;
      }
    });
    
    context += "\n" + "â•".repeat(50);
  }

  return [
    "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø¨Ø­Ø«ÙŠ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„ØªØ±Ø§Ø« Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØŒ ØªØ¹Ù…Ù„ Ø¶Ù…Ù† Ù…Ù†ØµØ© Ø¥Ù‚Ø±Ø£-12.",
    "Ù„Ø¯ÙŠÙƒ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¶Ø®Ù…Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 134 Ø¬Ø¯ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„ØªØ±Ø§Ø«ÙŠØ©.",
    "",
    modeLabel,
    detail,
    "",
    "Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:",
    "- Ø§Ø³ØªÙ†Ø¯ Ù„Ù„Ù†ØµÙˆØµ Ø§Ù„Ù…Ù‚Ø¯Ù…Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª",
    "- Ø§Ø°ÙƒØ± Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³",
    "- Ø§Ø±Ø¨Ø· Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…Ø®ØªÙ„ÙØ©",
    "- Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ù†ØµÙˆØµØ§Ù‹ Ø°Ø§Øª ØµÙ„Ø©ØŒ Ø£Ø¬Ø¨ Ù…Ù† Ù…Ø¹Ø±ÙØªÙƒ Ù…Ø¹ Ø§Ù„ØªÙ†ÙˆÙŠÙ‡",
    "- ÙƒÙ† Ø¯Ù‚ÙŠÙ‚Ø§Ù‹ ÙˆÙ…ÙˆØ¶ÙˆØ¹ÙŠØ§Ù‹",
    context,
    "",
    "Ø§Ù„Ø³Ø¤Ø§Ù„:",
    query,
  ].join("\n");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªØ±Ø¬Ù…Ø© Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getTableArabicName(tableName: string): string {
  return TABLE_ARABIC_NAMES[tableName] || tableName.replace(/_/g, " ");
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ØªØ³Ø¬ÙŠÙ„ ÙÙŠ BigQuery
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function logSearch(input: {
  query: string;
  answer: string;
  tables: string[];
  resultsCount: number;
}) {
  try {
    await bigquery
      .dataset(datasetId)
      .table("search_logs")
      .insert({
        query: input.query,
        answer_preview: input.answer.slice(0, 500),
        tables_searched: input.tables.join(","),
        results_count: input.resultsCount,
        created_at: new Date().toISOString(),
      });
  } catch (err) {
    console.warn("Logging failed:", err);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse<ApiResponse>
) {
  if (req.method !== "POST") {
    res.setHeader("Allow", "POST");
    return res.status(405).json({ error: "Only POST allowed" });
  }

  const body = (req.body || {}) as AskRequestBody;
  const { query, mode, detailLevel } = body;

  if (!query || typeof query !== "string") {
    return res.status(400).json({ error: "Ø­Ù‚Ù„ query Ù…Ø·Ù„ÙˆØ¨." });
  }

  try {
    // 1ï¸âƒ£ ÙˆÙƒÙŠÙ„ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡: ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
    const relevantTables = detectRelevantTables(query);
    console.log("ğŸ“Š Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©:", relevantTables.length, "Ø¬Ø¯ÙˆÙ„");
    console.log("   â†’", relevantTables.slice(0, 5).join(", "), "...");

    // 2ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
    const searchResults = await searchAllRelevantTables(relevantTables, query);
    console.log("ğŸ” Ø§Ù„Ù†ØªØ§Ø¦Ø¬:", searchResults.length, "Ù†ØªÙŠØ¬Ø©");

    // 3ï¸âƒ£ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ù…Ø¹ Ø§Ù„Ø³ÙŠØ§Ù‚
    const prompt = buildPromptWithContext(query, searchResults, mode, detailLevel);

    // 4ï¸âƒ£ Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Gemini
    const result = await generativeModel.generateContent({
      contents: [{ role: "user", parts: [{ text: prompt }] }],
    });

    const response: any = result.response;
    const candidates = response?.candidates ?? [];
    const answer = candidates
      .flatMap((c: any) => c.content?.parts ?? [])
      .map((p: any) => p.text ?? "")
      .join(" ")
      .trim() || "Ù„Ù… Ø£Ø³ØªØ·Ø¹ ØªÙˆÙ„ÙŠØ¯ Ø¥Ø¬Ø§Ø¨Ø©.";

    // 5ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø«
    void logSearch({
      query,
      answer,
      tables: relevantTables,
      resultsCount: searchResults.length,
    });

    // 6ï¸âƒ£ Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø¹ Ø§Ù„Ù…ØµØ§Ø¯Ø±
    return res.status(200).json({
      answer,
      mode: mode ?? "detailed",
      detailLevel: detailLevel ?? "medium",
      model: modelName,
      sources: searchResults,
      tablesSearched: relevantTables,
      totalTables: Object.keys(TABLE_KEYWORDS).length,
    });

  } catch (err: any) {
    console.error("Error:", err);
    return res.status(500).json({
      error: err?.message || "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.",
    });
  }
}
